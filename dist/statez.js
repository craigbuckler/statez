/* statez 1.0.0, by Craig Buckler, 2022-06-14T17:16 */
var i={},f={page:null,session:"sessionStorage",permanent:"localStorage"},c=class extends EventTarget{#t=null;#e=null;#s=0;#n=null;constructor(e,s,n,l){super(),this.#t=s,this.#e=e&&window[e],this.#s=(l||0)*1e3,this.#e&&(n=JSON.parse(this.#e.getItem(s))||n);for(let o in n)this[o]=n[o];this.#s&&this.syncState()}dispatchEvent(e={}){e.state=i[this.#t],super.dispatchEvent(new CustomEvent("change",{detail:e,bubbles:!1,cancelable:!1})),this.#s&&(clearTimeout(this.#n),this.#n=setTimeout(()=>this.syncState(),this.#s))}cleanState(){Object.getOwnPropertyNames(this).forEach(e=>{let s={property:e,valueOld:this[e]};delete this[e],this.dispatchEvent(s)})}syncState(){if(!this.#e)return;let e=JSON.stringify(this);e.length<3?this.#e.removeItem(this.#t):this.#e.setItem(this.#t,e)}},h={set:(t,e,s)=>{let n=Reflect.get(t,e),l=!0;return n!==s&&typeof t[e]!="function"&&(l=Reflect.set(t,e,s),l&&t.dispatchEvent({property:e,value:s,valueOld:n}),typeof s>"u"&&Reflect.deleteProperty(t,e)),l},deleteProperty:(t,e)=>{let s=Reflect.get(t,e);return Reflect.getOwnPropertyDescriptor(t,e)&&Reflect.deleteProperty(t,e)&&t.dispatchEvent({property:e,valueOld:s}),!0},get:(t,e)=>{let s=t[e];return typeof s=="function"?function(...n){return s.apply(t,n)}:Reflect.get(t,e)}};function d({type:t=f.permanent,name:e=null,init:s=null,sync:n=0}={}){return e=e||"stateZ"+(t||"page"),i[e]||(i[e]=new Proxy(new c(t,e,s,n),h)),i[e]}window.addEventListener("storage",t=>{let e=i[t.key];if(e){let s=JSON.parse(t.newValue);for(let n in s)JSON.stringify(e[n])!=JSON.stringify(s[n])&&(e[n]=s[n])}});window.addEventListener("beforeunload",()=>{for(let t in i)i[t].syncState()});export{d as stateZ,f as stateZtype};
